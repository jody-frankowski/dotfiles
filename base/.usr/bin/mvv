#!/bin/zsh

set -euo pipefail

if [[ $# -lt 2 || $1 == -h || $1 == --help ]]; then
    echo "Usage: $(basename $0) [RSYNC_OPTIONS] FILE|DIR... DESTINATION" >&2
    echo 'Moves files and directories.' >&2
    exit 1
fi

dirs=()
for src in "${@:1:$# - 1}"; do
    if [[ -d "${src}" ]] dirs+=("${src}")
done

if rsync -avPih --remove-source-files "$@"; then
    if [[ -n $dirs ]] bfs $dirs -type d -empty -delete
fi
