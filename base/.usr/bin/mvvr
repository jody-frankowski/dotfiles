#!/bin/zsh

if [[ $# -lt 2 || $1 == -h || $1 == --help ]]; then
    echo "Usage: $(basename $0) [RSYNC_OPTIONS] FILE|DIR... DESTINATION" >&2
    echo 'Moves files and directories to a slow destination that may require resuming.' >&2
    echo 'Files will be written in-place and will be compared based only on their size.' >&2
    exit 1
fi

dirs=()
for src in "${@:1:$# - 1}"; do
    if [[ -d "${src}" ]] dirs+=("${src}")
done

# Using `--inplace` might be dangerous in some cases, see
# https://lists.samba.org/archive/rsync/2010-June/025178.html
exec mvv --inplace --size-only --stats "$@"
